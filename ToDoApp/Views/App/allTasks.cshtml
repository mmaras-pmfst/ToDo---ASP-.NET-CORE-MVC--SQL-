
@{
    ViewData["Title"] = "allTasks";
    ViewBag.Title = "allTasks";
}
<style>
    a {
        cursor: pointer;
    }
    .bg-modal {
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        position: absolute;
        top: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        display: none;
    }

    .modal-content {
        width: 300px;
        height: 370px;
        background-color: #dade42;
        border-radius: 4px;
        text-align: center;
        padding: 15px;
        position: relative;
    }

    .adminForm-input {
        width: 50%;
        display: block;
        margin: 15px auto;
    }

    .close {
        position: absolute;
        top: 0;
        right: 15px;
        font-size: 35px;
        transform: rotate(45deg);
        cursor: pointer;
    }
    .bg-modal2 {
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        position: absolute;
        top: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        display: none;
    }

    .modal-content2 {
        width: 300px;
        height: 370px;
        background-color: #dade42;
        border-radius: 4px;
        text-align: center;
        padding: 15px;
        position: relative;
    }

    .adminForm-input2 {
        width: 50%;
        display: block;
        margin: 15px auto;
    }

    .close2 {
        position: absolute;
        top: 0;
        right: 15px;
        font-size: 35px;
        transform: rotate(45deg);
        cursor: pointer;
    }
</style>
<div class="searchDiv">
    <form action="#" method="POST" class="search">
        <div class="searchInput_Btn">
           
        </div>

        <div class="welcomeTitle">
            <h1>Welcome: @ViewBag.user</h1>
        </div>

        <div class="sort">
            <div class="dropdown">
                
            </div>
        </div>
    </form>
</div>
<div class="listsContainer">
    <!-- Uncompleted tasks -->
    <ul class="todo" id="todo2">
        
    </ul>
</div>
@* Edit one task *@
<div class="bg-modal" id="bg-modal">
    <div class="modal-content">

        <form>
            <div class="close" onclick="closeForm()" id="close">+</div>
            <input class="adminForm-input"
                   type="text"
                   name="task"
                   id="taskNewTitle"
                   placeholder="Title.." />
            <textarea name="desc"
                      class="adminForm-input"
                      cols=""
                      rows="10"
                      id="taskNewDesc"
                      placeholder="Description.."></textarea>
            <input name="timetable" type="datetime-local" id="taskNewTimetable" /><br />
            <label for="">Select date and time for this task</label>
            <input class="adminForm-input" type="button" value="Save Changes" id="changeButton" />

        </form>
</div>
</div>
@* View one task *@
<div class="bg-modal2" id="bg-modal2">
    <div class="modal-content2">
        <div class="close2" onclick="closeForm2()" id="close2">+</div>
        <h3 class="adminForm-input2"
            type="text"
            name="task"
            id="taskNewTitle2"></h3>
        <p name="desc"
           class="adminForm-input2"
           id="taskNewDesc2"></p>
        <hr />
        <p class="adminForm-input2" name="timetable" id="taskNewTimetable2"></p>
        <hr />
        <p class="adminForm-input2" name="timetable" id="taskCreated"></p>

    </div>
</div>

<div class="navigation">
    <a href="/todo/logout">
        <button class="profile">
            <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
            <g transform="translate(1 1)">
            <g>
            <g>
            <path class="profile" d="M319,319c-11.782,0-21.333,9.551-21.333,21.333v128h-256V41.667h256v128c0,11.782,9.551,21.333,21.333,21.333
				s21.333-9.551,21.333-21.333V20.333C340.333,8.551,330.782-1,319-1H20.333C8.551-1-1,8.551-1,20.333v469.333
				C-1,501.449,8.551,511,20.333,511H319c11.782,0,21.333-9.551,21.333-21.333V340.333C340.333,328.551,330.782,319,319,319z" />

            <path class="profile" d="M506.164,268.52c0.204-0.248,0.38-0.509,0.571-0.764c0.226-0.302,0.461-0.598,0.671-0.913
				c0.204-0.304,0.38-0.62,0.566-0.932c0.17-0.285,0.349-0.564,0.506-0.857c0.17-0.318,0.315-0.646,0.468-0.971
				c0.145-0.306,0.297-0.607,0.428-0.921c0.13-0.315,0.236-0.637,0.35-0.957c0.121-0.337,0.25-0.669,0.354-1.013
				c0.097-0.32,0.168-0.646,0.249-0.969c0.089-0.351,0.187-0.698,0.258-1.055c0.074-0.375,0.118-0.753,0.173-1.13
				c0.044-0.311,0.104-0.617,0.135-0.933c0.138-1.4,0.138-2.811,0-4.211c-0.031-0.315-0.09-0.621-0.135-0.933
				c-0.054-0.377-0.098-0.756-0.173-1.13c-0.071-0.358-0.169-0.704-0.258-1.055c-0.081-0.324-0.152-0.649-0.249-0.969
				c-0.104-0.344-0.233-0.677-0.354-1.013c-0.115-0.32-0.22-0.642-0.35-0.957c-0.13-0.314-0.283-0.615-0.428-0.921
				c-0.153-0.325-0.297-0.653-0.468-0.971c-0.157-0.293-0.336-0.572-0.506-0.857c-0.186-0.312-0.363-0.628-0.566-0.932
				c-0.211-0.315-0.445-0.611-0.671-0.913c-0.191-0.255-0.368-0.516-0.571-0.764c-0.439-0.535-0.903-1.05-1.392-1.54
				c-0.007-0.008-0.014-0.016-0.021-0.023l-85.333-85.333c-8.331-8.331-21.839-8.331-30.17,0s-8.331,21.839,0,30.17l48.915,48.915
				H255c-11.782,0-21.333,9.551-21.333,21.333c0,11.782,9.551,21.333,21.333,21.333h183.163l-48.915,48.915
				c-8.331,8.331-8.331,21.839,0,30.17c8.331,8.331,21.839,8.331,30.17,0l85.333-85.333c0.008-0.008,0.014-0.016,0.021-0.023
				C505.261,269.57,505.725,269.055,506.164,268.52z" />

		</g>
	</g>
</g>

</svg>
        </button>
    </a>

    <button class="addBtn" onClick="parent.location='/todo/newtask'">
        <svg version="1.1"
             id="Layer_1"
             xmlns="http://www.w3.org/2000/svg"
             xmlns:xlink="http://www.w3.org/1999/xlink"
             x="0px"
             y="0px"
             viewBox="0 0 16 16"
             style="enable-background:new 0 0 16 16;"
             xml:space="preserve">
        <g>
        <g>
        <path class="fill"
              d="M16,8c0,0.5-0.5,1-1,1H9v6c0,0.5-0.5,1-1,1s-1-0.5-1-1V9H1C0.5,9,0,8.5,0,8s0.5-1,1-1h6V1c0-0.5,0.5-1, 1-1
			      s1,0.5,1,1v6h6C15.5,7,16,7.5,16,8z" />

            </g>
          </g>
        </svg>
    </button>
    <a href="/todo/completed">
        <button class="complete">
            <svg version="1.1"
                 id="Capa_1"
                 xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink"
                 x="0px"
                 y="0px"
                 viewBox="0 0 512 512"
                 style="enable-background:new 0 0 512 512;"
                 xml:space="preserve">
            <g>
            <g>
            <path class="list"
                  d="M251.328,196.704c-6.24-6.24-16.384-6.272-22.656-0.032L176,249.376l-20.672-20.704c-6.24-6.24-16.384-6.24-22.624,0
      			s-6.24,16.384,0,22.624l32,32c3.104,3.136,7.2,4.704,11.296,4.704s8.192-1.568,11.328-4.672l64-64
      			C257.568,213.088,257.568,202.944,251.328,196.704z" />

              </g>
            </g>
            <g>
            <g>
            <path class="list"
                  d="M251.328,324.704c-6.24-6.24-16.384-6.272-22.656-0.032L176,377.376l-20.672-20.672c-6.24-6.24-16.384-6.24-22.624,0
      			s-6.24,16.384,0,22.624l32,32c3.104,3.104,7.2,4.672,11.296,4.672s8.192-1.568,11.328-4.672l64-64
      			C257.568,341.088,257.568,330.944,251.328,324.704z" />

              </g>
            </g>
            <g>
            <g>
            <path class="list"
                  d="M368,224h-64c-8.832,0-16,7.168-16,16c0,8.832,7.168,16,16,16h64c8.832,0,16-7.168,16-16C384,231.168,376.832,224,368,224
      			z" />

              </g>
            </g>
            <g>
            <g>
            <path class="list"
                  d="M368,352h-64c-8.832,0-16,7.168-16,16c0,8.832,7.168,16,16,16h64c8.832,0,16-7.168,16-16C384,359.168,376.832,352,368,352
      			z" />

              </g>
            </g>
            <g>
            <g>
            <path class="list"
                  d="M416,64h-64V48c0-8.832-7.168-16-16-16h-34.72C294.656,13.376,276.864,0,256,0s-38.656,13.376-45.28,32H176
      			c-8.832,0-16,7.168-16,16v16H96c-17.632,0-32,14.368-32,32v384c0,17.632,14.368,32,32,32h320c17.632,0,32-14.368,32-32V96
      			C448,78.368,433.632,64,416,64z M192,64h32c8.832,0,16-7.168,16-16c0-8.832,7.168-16,16-16c8.832,0,16,7.168,16,16
      			c0,8.832,7.168,16,16,16h32v32H192V64z M416,480H96V96h64v16c0,8.832,7.168,16,16,16h160c8.832,0,16-7.168,16-16V96h64V480z" />

              </g>
            </g>
          </svg>
        </button>
    </a>
</div>

<script type="text/javascript">

    

    function Remove(id) {
        axios.delete(`/api/tasks/${id}`, id);
        timedRefresh(500);

    }
    async function Save(id) {
        console.log("Saving changes....")
        var today = new Date();
        var time = "Date: " + today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate() + " Time: " + today.getHours() + ":" + today.getMinutes();
        let taskEdit = {
            "id": id,
            "title": `${document.getElementById("taskNewTitle").value}`,
            "description": `${document.getElementById("taskNewDesc").value}`,
            "datetime": time,
            "complete": "No",
            "timetable": `${document.getElementById("taskNewTimetable").value}`,
            "userid": 0
        }
        axios.put("/api/tasks/taskedit", taskEdit);

        timedRefresh(500);
    }

    function Complete(id) {
        axios.get(`/api/tasks/${id}`).then(response => changeComplete(response.data));
    }
    async function changeComplete(task) {

        let completed = {
            "id": task.id,
            "title": task.title,
            "description": task.description,
            "datetime": task.dateTime,
            "complete": "Yes",
            "timetable": task.timetable,
            "userid": task.userId
        }
        axios.put("/api/tasks/taskedit", completed);
        timedRefresh(500);
    }
    function Add(task) {
        for (var i = 0; i < task.length; i++) {
            var ul = document.getElementById("todo2");
            var li = document.createElement("li");
            var node = `<a onclick="openForm2(${task[i].id})">${task[i].title}</a>
                <div class="buttons">
                    <a onclick="Complete(${task[i].id})">
                        <button class="complete">
                            <svg width="20px"
                                 height="20px"
                                 version="1.1"
                                 id="Capa_1"
                                 xmlns="http://www.w3.org/2000/svg"
                                 xmlns:xlink="http://www.w3.org/1999/xlink"
                                 x="0px"
                                 y="0px"
                                 viewBox="0 0 52 52"
                                 style="enable-background:new 0 0 52 52;"
                                 xml:space="preserve">
                            <g>
                            <path d="M26,0C11.664,0,0,11.663,0,26s11.664,26,26,26s26-11.663,26-26S40.336,0,26,0z M26,50C12.767,50,2,39.233,2,26
                      S12.767,2,26,2s24,10.767,24,24S39.233,50,26,50z" />

                            <path d="M38.252,15.336l-15.369,17.29l-9.259-7.407c-0.43-0.345-1.061-0.274-1.405,0.156c-0.345,0.432-0.275,1.061,0.156,1.406
                      l10,8C22.559,34.928,22.78,35,23,35c0.276,0,0.551-0.114,0.748-0.336l16-18c0.367-0.412,0.33-1.045-0.083-1.411
                      C39.251,14.885,38.62,14.922,38.252,15.336z" />

                  </g>
                </svg>
                        </button>
                    </a>
                    <a onclick="openForm(${task[i].id})">
                        <button class="edit">
                            <svg width="20px"
                                 height="20px"
                                 viewBox="0 -1 401.52289 401"
                                 width="401pt"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path class="edit"
                                      d="m370.589844 250.972656c-5.523438 0-10 4.476563-10 10v88.789063c-.019532 16.5625-13.4375 29.984375-30 30h-280.589844c-16.5625-.015625-29.980469-13.4375-30-30v-260.589844c.019531-16.558594 13.4375-29.980469 30-30h88.789062c5.523438 0 10-4.476563 10-10 0-5.519531-4.476562-10-10-10h-88.789062c-27.601562.03125-49.96875 22.398437-50 50v260.59375c.03125 27.601563 22.398438 49.96875 50 50h280.589844c27.601562-.03125 49.96875-22.398437 50-50v-88.792969c0-5.523437-4.476563-10-10-10zm0 0" />
                                <path class="edit"
                                      d="m376.628906 13.441406c-17.574218-17.574218-46.066406-17.574218-63.640625 0l-178.40625 178.40625c-1.222656 1.222656-2.105469 2.738282-2.566406 4.402344l-23.460937 84.699219c-.964844 3.472656.015624 7.191406 2.5625 9.742187 2.550781 2.546875 6.269531 3.527344 9.742187 2.566406l84.699219-23.464843c1.664062-.460938 3.179687-1.34375 4.402344-2.566407l178.402343-178.410156c17.546875-17.585937 17.546875-46.054687 0-63.640625zm-220.257812 184.90625 146.011718-146.015625 47.089844 47.089844-146.015625 146.015625zm-9.40625 18.875 37.621094 37.625-52.039063 14.417969zm227.257812-142.546875-10.605468 10.605469-47.09375-47.09375 10.609374-10.605469c9.761719-9.761719 25.589844-9.761719 35.351563 0l11.738281 11.734375c9.746094 9.773438 9.746094 25.589844 0 35.359375zm0 0" />
                            </svg>
                        </button>
                    </a>

                    <a onclick="Remove(${task[i].id})">
                        <button class="remove">
                            <svg width="20px"
                                 height="20px"
                                 version="1.1"
                                 id="Layer_1"
                                 xmlns="http://www.w3.org/2000/svg"
                                 xmlns:xlink="http://www.w3.org/1999/xlink"
                                 x="0px"
                                 y="0px"
                                 viewBox="0 0 22 22"
                                 style="enable-background:new 0 0 22 22;"
                                 xml:space="preserve">
                            <g>
                            <g>
                            <path class="st0"
                                  d="M16.1,3.6h-1.9V3.3c0-1.3-1-2.3-2.3-2.3h-1.7C8.9,1,7.8,2,7.8,3.3v0.2H5.9c-1.3,0-2.3,1-2.3,2.3v1.3
                        c0,0.5,0.4,0.9,0.9,1v10.5c0,1.3,1,2.3,2.3,2.3h8.5c1.3,0,2.3-1,2.3-2.3V8.2c0.5-0.1,0.9-0.5,0.9-1V5.9
                        C18.4,4.6,17.4,3.6,16.1,3.6z M9.1,3.3c0-0.6,0.5-1.1,1.1-1.1h1.7c0.6,0,1.1,0.5,1.1,1.1v0.2H9.1V3.3z M16.3,18.7
                        c0,0.6-0.5,1.1-1.1,1.1H6.7c-0.6,0-1.1-0.5-1.1-1.1V8.2h10.6L16.3,18.7L16.3,18.7z M17.2,7H4.8V5.9c0-0.6,0.5-1.1,1.1-1.1h10.2
                        c0.6,0,1.1,0.5,1.1,1.1V7z" />

                    </g>
                            <g>
                            <g>
                            <path class="st0"
                                  d="M11,18c-0.4,0-0.6-0.3-0.6-0.6v-6.8c0-0.4,0.3-0.6,0.6-0.6s0.6,0.3,0.6,0.6v6.8C11.6,17.7,11.4,18,11,18z" />

                      </g>
                            <g>
                            <path class="st0"
                                  d="M8,18c-0.4,0-0.6-0.3-0.6-0.6v-6.8C7.4,10.2,7.7,10,8,10c0.4,0,0.6,0.3,0.6,0.6v6.8C8.7,17.7,8.4,18,8,18z" />

                      </g>
                            <g>
                            <path class="st0"
                                  d="M14,18c-0.4,0-0.6-0.3-0.6-0.6v-6.8c0-0.4,0.3-0.6,0.6-0.6c0.4,0,0.6,0.3,0.6,0.6v6.8
                            C14.6,17.7,14.3,18,14,18z" />

                      </g>
                    </g>
                  </g>
                </svg>
                        </button>
                    </a>
                </div>`
            li.innerHTML = node;
            ul.appendChild(li);
        }
    }
    async function openForm(id) {

        axios.get(`/api/tasks/${id}`).then(response => (console.log(response.data),
            document.getElementById("taskNewTitle").value = response.data.title,
            document.getElementById("taskNewDesc").value = response.data.description,
            document.getElementById("taskNewTimetable").value = response.data.timetable,
            document.getElementById("changeButton").setAttribute("onclick", `Save(${response.data.id})`)));

        document.getElementById("bg-modal").style.display = "flex";
    }
    function closeForm() {
        document.getElementById("bg-modal").style.display = "none";
    }
    async function openForm2(id) {

        axios.get(`/api/tasks/${id}`).then(response => (console.log(response.data),
            document.getElementById("taskNewTitle2").innerHTML = response.data.title,
            document.getElementById("taskNewDesc2").innerHTML = response.data.description,
            document.getElementById("taskNewTimetable2").innerHTML = "Task deadline: " + response.data.timetable,
            document.getElementById("taskCreated").innerHTML = "Task created: " + response.data.dateTime

        ));

        document.getElementById("bg-modal2").style.display = "flex";
    }
    function closeForm2() {
        document.getElementById("bg-modal2").style.display = "none";
    }
    function timedRefresh(time) {
        setTimeout("location.reload(true);", time);
    }
    axios.get('/api/tasks').then(response => (Add(response.data), console.log(response.data)));
</script>

